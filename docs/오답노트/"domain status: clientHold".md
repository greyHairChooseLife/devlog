---
hide:
title: "domain status: clientHold"
date: 2024-03-26
---

## 문제 인식

2주 쯤 전에 구입하여 서비스를 연결시켜둔 도메인이 갑자기 접속이 안된다.

그런데 nginx를 통해 동일한 컨테이너를 연결해둔 다른 도메인으로는 접속이 잘만 된다.

## 문제 원인

도메인이 ICANN에 의해 정지되었다. AWS 계정을 통해 처음 도메인을 구입하면, AWS 가입시 했던 인증과는 별개로 도메인 소유자 인증을 해야한다.

이걸 안해도 일정기간 정상 이용 가능한데, 약 3~15일 정도다. 이것이 지나면 도메인이 정지(suspended)된다.

## 문제 해결

1. 도메인 구입처를 통해 소유자 인증을 해야한다. 내 경우는 AWS Route53를 통해 구입했으니, AWS Route53 콘솔에서 인증을
   진행했다. (이메일 다시보내기를 위한 배너가 떴다.)

2. 도메인 소유자 정보가 인증되었음을 알리는 메일이 왔다.

   > Dear AWS customer,
   >
   > Your email address [인증 받은 이메일] has been successfully verified for domain reg
   > istration. No further action is required on your part.
   >
   > Regards,
   > Amazon Route 53

3. (이후 호스트존을 재생성해도 도메인 정상화가 안된다.)

4. 검색하다보니 AWS support에 티켓을 발행하여 해결했다는 후기를 봤다. 나도 남긴다.

## 나의 여정

<details>
<summary>펼치기</summary>

1. DNS 관련 문제라고 생각했다. 일단 브라우저에서도 그렇게 말하고, 서비스가 죽은것이 아니라는것을 확인했으니까.

   > 서비스 성숙도 면에서도, 시기적으로도 사용이 아주 활발한 서비스는 아니었으나 어쨌든 실사용으로 개시되었기 때문에 나는 마음이 급했다.
   > 주말이라 다행이었지만, 정확한 원인 분석과 공부보단 빠른 해결이 중요했다.

2. AWS route53에 등록된 레코드를 다시 한번 살펴봤다. 레코드를 재생성하거나 호스트존을 삭제하고 다시 생성해보기도 했다. 안된다.
3. 혹시 nginx에서 upstream으로 설정해둔 컨테이너를 여러 도메인에 연결시켜서 문제가 된걸까? 근거는 없지만 간단한 테스트이니 nginx config에서 단일한 server로 설정해봤다. 그래도 안된다.
4. 컨테이너로 제공중인 서비스와 관련된 문제인지 파악하기 위해, 도메인에 upstream 서비스 말고 그냥 text를 제공하도록 설정해봤다.

   ```nginx
   server {
     listen 80;
     server_name mydomain.problem;

     location / {
       return 200 'Hello, world!';
     }
   }
   ```

   안된다.

5. 그럼 이제 도메인이 서버의 ip로 잘 연결되는지를 확인할 차례다. AWS route53을 DNS로 사용하고 있으니, route53에서 확인해보자. 친절하게도 _레코드 테스트_ 기능을를 제공해준다. 잘 연결이 되어있다. DNS도 문제없다.

6. 그런데 생각해보니 도메인을 구입할 수 있는 곳은 AWS 뿐만 아니다. 이 말은 도메인을 관리하는 기구(?)는 별도로 존재할 수 있다는 것이다.

   내 도메인 리스트에 들어가본다. 도메인 구입 계약 상태나 소유주에 대한 정보와 함께 뭔가 있을 수 있다. 그랬더니 [대문짝만하게 배너](./domain_suspended_by_ICANN.png)가 뜬다. 메일을 인증 해 달라고...

7. 좀더 검색해보니 정해진 기간(약 15일) 안에 도메인 소유주 인증을 완료하지 않으면(도메인 소유자로 등록한 주소에 이메일이 왔었다.), ICANN에 의해 suspended 된다고 한다.

</details>
